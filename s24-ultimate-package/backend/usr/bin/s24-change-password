#!/bin/sh
# S24 Change Password

read POST_DATA

CURRENT=$(echo "$POST_DATA" | sed 's/.*"current":"\([^"]*\)".*/\1/')
NEW=$(echo "$POST_DATA" | sed 's/.*"newPass":"\([^"]*\)".*/\1/')

[ -z "$NEW" ] && echo '{"error":"New password required"}' && exit 1
[ ${#NEW} -lt 8 ] && echo '{"error":"Password must be at least 8 characters"}' && exit 1

# Change root password
echo -e "$NEW\n$NEW" | passwd root >/dev/null 2>&1

if [ $? -eq 0 ]; then
    echo '{"success":true,"message":"Password updated successfully"}'
else
    echo '{"error":"Failed to update password"}'
    exit 1
fi

